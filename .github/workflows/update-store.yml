name: Sync Nebula.uc.js to Store

on:
  push:
    paths:
      - "JS/Nebula.uc.js"
    branches:
      - main
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      # Checkout your Zen-Nebula repo (the source of truth)
      - name: Checkout Zen-Nebula
        uses: actions/checkout@v3
        with:
          repository: JustAdumbPrsn/Zen-Nebula
          ref: main
          path: zen-nebula

      # Checkout your fork of sineorg/store (target repo)
      - name: Checkout fork of store
        uses: actions/checkout@v3
        with:
          repository: JustAdumbPrsn/store
          ref: main
          path: store
          token: ${{ secrets.GITHUB_TOKEN }}

      # Copy the updated file into the fork repo
      - name: Update Nebula.uc.js in fork
        run: |
          cp zen-nebula/JS/Nebula.uc.js store/mods/Nebula/Nebula.uc.js
          cd store
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git checkout -B auto-update-nebula
          git add mods/Nebula/Nebula.uc.js
          git commit -m "Update Nebula.uc.js from Zen-Nebula" || echo "No changes to commit"
          # âœ… push with PAT explicitly
          git push https://x-access-token:${{ secrets.FORK_PAT }}@github.com/JustAdumbPrsn/store.git auto-update-nebula --force


      # Create the PR into sineorg/store
      - name: Create Pull Request
        run: |
          gh pr create \
            --repo sineorg/store \
            --head JustAdumbPrsn:auto-update-nebula \
            --base main \
            --title "Automated update of Nebula.uc.js" \
            --body "This PR was automatically created by GitHub Actions to sync Nebula.uc.js from Zen-Nebula."
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
